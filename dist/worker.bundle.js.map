{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/message.ts","webpack:///./src/worker.ts"],"names":[],"mappings":"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","file":"worker.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"./dist/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/worker.ts\");\n","/* Copyright 2018 Mozilla Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport enum WorkerCommand {\n  OptimizeWasmWithBinaryen,\n  ValidateWasmWithBinaryen,\n  CreateWasmCallGraphWithBinaryen,\n  ConvertWasmToAsmWithBinaryen,\n  DisassembleWasmWithBinaryen,\n  AssembleWatWithBinaryen,\n  DisassembleWasmWithWabt,\n  AssembleWatWithWabt,\n  TwiggyWasm\n}\n\n/**\n * Worker requests.\n */\nexport interface IWorkerRequest {\n  id: number;\n  payload: ArrayBuffer | string;\n  command: WorkerCommand;\n}\n\n/**\n * Worker response.\n */\nexport interface IWorkerResponse {\n  id: number;\n  payload: ArrayBuffer | string | Object;\n  success: boolean;\n}\n","/* Copyright 2018 Mozilla Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { IWorkerRequest, WorkerCommand, IWorkerResponse } from \"./message\";\n\ndeclare var importScripts: Function;\n\nfunction assert(c: any, message?: string) {\n    if (!c) {\n        throw new Error(message);\n    }\n}\n\ndeclare interface BinaryenModule {\n    optimize(): any;\n    validate(): any;\n    emitBinary(): ArrayBuffer;\n    emitText(): string;\n    emitAsmjs(): string;\n    runPasses(passes: string[]): any;\n}\n\ndeclare var Binaryen: {\n    readBinary(data: Uint8Array): BinaryenModule;\n    parseText(data: string): BinaryenModule;\n    print(s: string): void;\n    printErr(s: string): void;\n};\n\ndeclare var wabt: {\n    ready: Promise<any>\n    readWasm: Function;\n    parseWat: Function;\n};\n\nasync function loadBinaryen() {\n    if (typeof Binaryen === \"undefined\") {\n        importScripts(\"https://cdn.rawgit.com/AssemblyScript/binaryen.js/v48.0.0-nightly.20180624/index.js\");\n    }\n}\n\nasync function loadWabt() {\n    if (typeof wabt === \"undefined\") {\n        (self as any).global = self; // Wabt installs itself on the global object.\n        importScripts(\"https://cdn.rawgit.com/AssemblyScript/wabt.js/v1.0.0-nightly.20180421/index.js\");\n    }\n}\n\nlet Twiggy: any = null;\ndeclare var wasm_bindgen: any;\n\nasync function loadTwiggy() {\n    if (!Twiggy) {\n        importScripts(\"../lib/twiggy_wasm_api.js\");\n        await wasm_bindgen(\"../lib/twiggy_wasm_api_bg.wasm\");\n        Twiggy = {\n            Items: wasm_bindgen.Items,\n            Top: wasm_bindgen.Top,\n            Paths: wasm_bindgen.Paths,\n            Monos: wasm_bindgen.Monos,\n            Dominators: wasm_bindgen.Dominators\n        };\n    }\n}\n\nonmessage = (e: { data: IWorkerRequest }) => {\n    const fn = {\n        [WorkerCommand.OptimizeWasmWithBinaryen]: optimizeWasmWithBinaryen,\n        [WorkerCommand.ValidateWasmWithBinaryen]: validateWasmWithBinaryen,\n        [WorkerCommand.CreateWasmCallGraphWithBinaryen]: createWasmCallGraphWithBinaryen,\n        [WorkerCommand.ConvertWasmToAsmWithBinaryen]: convertWasmToAsmWithBinaryen,\n        [WorkerCommand.DisassembleWasmWithBinaryen]: disassembleWasmWithBinaryen,\n        [WorkerCommand.AssembleWatWithBinaryen]: assembleWatWithBinaryen,\n        [WorkerCommand.DisassembleWasmWithWabt]: disassembleWasmWithWabt,\n        [WorkerCommand.AssembleWatWithWabt]: assembleWatWithWabt,\n        [WorkerCommand.TwiggyWasm]: twiggyWasm\n    }[e.data.command];\n    assert(fn, `Command ${e.data.command} not found.`);\n    processMessage(e.data, fn);\n};\n\nasync function processMessage(request: IWorkerRequest, fn: Function) {\n    const response: IWorkerResponse = {\n        id: request.id,\n        payload: null,\n        success: true\n    };\n    try {\n        response.payload = await fn(request.payload);\n    } catch (e) {\n        response.payload = {\n            message: e.message\n        };\n        response.success = false;\n    }\n    postMessage(response, undefined);\n}\n\nasync function optimizeWasmWithBinaryen(data: ArrayBuffer): Promise<ArrayBuffer> {\n    await loadBinaryen();\n    const module = Binaryen.readBinary(new Uint8Array(data));\n    module.optimize();\n    return Promise.resolve(module.emitBinary());\n}\n\nasync function validateWasmWithBinaryen(data: ArrayBuffer): Promise<number> {\n    await loadBinaryen();\n    const module = Binaryen.readBinary(new Uint8Array(data));\n    return Promise.resolve(module.validate());\n}\n\nasync function createWasmCallGraphWithBinaryen(data: ArrayBuffer): Promise<string> {\n    await loadBinaryen();\n    const module = Binaryen.readBinary(new Uint8Array(data));\n    const old = Binaryen.print;\n    let ret = \"\";\n    Binaryen.print = (x: string) => { ret += x + \"\\n\"; };\n    module.runPasses([\"print-call-graph\"]);\n    Binaryen.print = old;\n    return Promise.resolve(ret);\n}\n\nasync function convertWasmToAsmWithBinaryen(data: ArrayBuffer): Promise<string> {\n    await loadBinaryen();\n    const module = Binaryen.readBinary(new Uint8Array(data));\n    module.optimize();\n    return Promise.resolve(module.emitAsmjs());\n}\n\nasync function disassembleWasmWithBinaryen(data: ArrayBuffer): Promise<string> {\n    await loadBinaryen();\n    const module = Binaryen.readBinary(new Uint8Array(data));\n    return Promise.resolve(module.emitText());\n}\n\nasync function assembleWatWithBinaryen(data: string): Promise<ArrayBuffer> {\n    await loadBinaryen();\n    const module = Binaryen.parseText(data);\n    return Promise.resolve(module.emitBinary());\n}\n\nasync function disassembleWasmWithWabt(data: ArrayBuffer): Promise<string> {\n    await loadWabt();\n    const module = wabt.readWasm(data, { readDebugNames: true });\n    module.generateNames();\n    module.applyNames();\n    return Promise.resolve(module.toText({ foldExprs: false, inlineExport: true }));\n}\n\nasync function assembleWatWithWabt(data: string): Promise<ArrayBuffer> {\n    await loadWabt();\n    const module = wabt.parseWat(\"test.wat\", data);\n    module.resolveNames();\n    module.validate();\n    return Promise.resolve(module.toBinary({ log: true, write_debug_names: true }).buffer);\n}\n\ninterface IDominator {\n    children: IDominator[];\n    name: string;\n    retained_size: number;\n    retained_size_percent: number;\n    shallow_size: number;\n    shallow_size_percent: number;\n}\n\nasync function twiggyWasm(data: ArrayBuffer): Promise<string> {\n    await loadTwiggy();\n    let opts;\n    const items = Twiggy.Items.parse(new Uint8Array(data));\n\n    let md = \"# Twiggy Analysis\\n\\nTwiggy is a code size profiler, learn more about it [here](https://github.com/rustwasm/twiggy).\\n\\n\";\n\n    // Top\n    opts = Twiggy.Top.new();\n    const top: Array<{ name: string, shallow_size: number, shallow_size_percent: number }> = JSON.parse(items.top(opts));\n\n    md += \"## Top\\n\\n\";\n    md += \"| Shallow Bytes | Shallow % | Item |\\n\";\n    md += \"| ------------: | --------: | :--- |\\n\";\n\n    let ignoreCount = 0;\n    const shallowSizePercentIgnoreThreshold = 0.1;\n    top.forEach(entry => {\n        if (entry.shallow_size_percent >= shallowSizePercentIgnoreThreshold) {\n            md += `| ${entry.shallow_size} | ${entry.shallow_size_percent.toFixed(2)} | \\`${entry.name}\\` |\\n`;\n        } else {\n            ignoreCount++;\n        }\n    });\n\n    if (ignoreCount) {\n        md += `\\n### Note:\\n${ignoreCount} items had a shallow size percent less than ${shallowSizePercentIgnoreThreshold} and were not listed above.\\n`;\n    }\n\n    // Paths\n    // md += \"\\n\\n# Paths\\n\\n\";\n    // opts = Twiggy.Paths.new();\n    // const paths = JSON.parse(items.paths(opts));\n\n    // Monos\n    // md += \"\\n\\n# Monos\\n\\n\";\n    // opts = Twiggy.Monos.new();\n    // opts.set_max_generics(10);\n    // opts.set_max_monos(10);\n    // const monos = JSON.parse(items.monos(opts));\n\n    md += \"\\n\\n## Dominators\\n\\n\";\n    md += \"| Retained Bytes | Retained % | Dominator Tree |\\n\";\n    md += \"| ------------: | --------: | :--- |\\n\";\n\n    // Dominators\n    const retainedSizePercentIgnoreThreshold = 0.1;\n    ignoreCount = 0;\n    opts = Twiggy.Dominators.new();\n    const dominator: IDominator = JSON.parse(items.dominators(opts));\n    function printDominator(dominator: IDominator, depth: number) {\n        let prefix = \"\";\n        for (let i = 0; i < depth - 1; i++) {\n            prefix += \"   \";\n        }\n        if (depth) {\n            prefix += \"⤷ \";\n        }\n        md += `| ${dominator.retained_size} | ${dominator.retained_size_percent.toFixed(2)} | \\`${prefix + dominator.name}\\` |\\n`;\n        if (dominator.children) {\n            dominator.children.forEach(child => {\n                if (child.retained_size_percent >= retainedSizePercentIgnoreThreshold) {\n                    printDominator(child, depth + 1);\n                } else {\n                    ignoreCount++;\n                }\n            });\n        }\n    }\n    printDominator(dominator, 0);\n    if (ignoreCount) {\n        md += `\\n### Note:\\n${ignoreCount} items had a retained size percent less than ${retainedSizePercentIgnoreThreshold} and were not listed above.\\n`;\n    }\n    return Promise.resolve(md);\n}\n"],"sourceRoot":""}